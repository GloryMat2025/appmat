<div class="offline-wrapper" id="offline-wrapper" hidden>
  <div class="offline-box" role="status" aria-live="polite" aria-label="Offline notification">
    <div class="offline-icon" aria-hidden="true">
      <svg
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        width="56"
        height="56"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path d="M17 17L7 7m10 0L7 17"></path>
      </svg>
    </div>

    <h1 class="offline-title">Offline</h1>

    <p class="offline-message">
      You're offline or the network is unstable.<br />
      Please check your connection and try again.
    </p>

    <div class="offline-actions">
      <button id="retry-button" class="btn-retry" type="button">Retry</button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const wrapper = document.getElementById('offline-wrapper');
    if (!wrapper) return;

    const retry = document.getElementById('retry-button');

    function updateVisibility() {
      // show when offline, hide when online
      wrapper.hidden = navigator.onLine;
    }

    // Initial state
    updateVisibility();

    // React to network changes
    window.addEventListener('online', updateVisibility);
    window.addEventListener('offline', updateVisibility);

    // Retry button behavior: prefer graceful check before reload
    retry?.addEventListener('click', async () => {
      if (navigator.onLine) {
        // quick network probe to avoid reloading when still effectively offline
        try {
          await fetch('/', { method: 'HEAD', cache: 'no-store', mode: 'no-cors' });
          location.reload();
        } catch {
          // animate feedback when still offline
          const box = wrapper.querySelector('.offline-box');
          box &&
            box.animate(
              [
                { transform: 'translateY(0)' },
                { transform: 'translateY(-6px)' },
                { transform: 'translateY(0)' },
              ],
              { duration: 220 }
            );
        }
      } else {
        const box = wrapper.querySelector('.offline-box');
        box &&
          box.animate(
            [
              { transform: 'translateY(0)' },
              { transform: 'translateY(-6px)' },
              { transform: 'translateY(0)' },
            ],
            { duration: 220 }
          );
      }
    });
  });
</script>

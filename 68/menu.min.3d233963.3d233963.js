(()=>{const $=(e,t=document)=>t.querySelector(e),e=$("[data-category-bar]"),t=$("[data-products-grid]"),a=$("[data-skeleton-cards]"),r=$("[data-favorites-filter]"),n=$("[data-favorites-empty]"),s=$("[data-search-empty]"),o=$("[data-search-input]");if(!e||!t)return;const i="favorites:v1",c={products:[],categories:[],activeCat:"all",favorites:new Set(JSON.parse(localStorage.getItem(i)||"[]")),onlyFavs:!1,q:""};function renderCategories(){e.innerHTML="",c.categories.forEach(t=>{const a="all"===t?"Semua":t.charAt(0).toUpperCase()+t.slice(1),r=document.createElement("button");r.type="button",r.textContent=a,r.dataset.id=t,r.setAttribute("aria-pressed",String(c.activeCat===t)),r.className="whitespace-nowrap rounded-2xl px-4 py-2 text-sm border "+(c.activeCat===t?"bg-black text-white border-black shadow":"bg-white text-gray-800 border-gray-200 hover:bg-gray-50"),r.addEventListener("click",()=>{c.activeCat=t,((e,t=document)=>[...t.querySelectorAll(e)])(".cat-pill",e).forEach(e=>e.setAttribute("aria-pressed","false")),renderCategories(),renderGrid()}),r.classList.add("cat-pill"),e.appendChild(r)})}function cardEl(e){const t=document.createElement("article");t.className="group rounded-2xl ring-1 ring-gray-200 bg-white overflow-hidden hover:shadow-md transition",t.setAttribute("data-id",e.id),t.setAttribute("data-cat",e.category||"uncat");const a=document.createElement("div");a.className="aspect-square w-full overflow-hidden bg-gray-100";const r=document.createElement("img");r.src=e.img,r.alt=e.name,r.loading="lazy",r.decoding="async",r.className="h-full w-full object-cover group-hover:scale-105 transition",a.appendChild(r);const n=document.createElement("div");n.className="p-3";const s=document.createElement("h3");s.className="font-semibold leading-snug line-clamp-2",s.textContent=e.name;const o=document.createElement("div");o.className="mt-1 text-sm text-gray-500 capitalize",o.textContent=e.category;const i=document.createElement("div");var d;i.className="mt-2 font-semibold",i.textContent=(d=e.price,new Intl.NumberFormat("ms-MY",{style:"currency",currency:"MYR",maximumFractionDigits:2}).format(d));const l=document.createElement("button");l.type="button",l.setAttribute("aria-label","Tambah ke kegemaran"),l.dataset.fav=e.id;const g=c.favorites.has(e.id);if(l.setAttribute("aria-pressed",String(g)),l.className="mt-2 text-[12px] px-2 py-1 rounded-lg ring-1 "+(g?"ring-rose-300 bg-rose-50 text-rose-700":"ring-gray-300 text-gray-700 bg-white"),l.textContent=g?"★ Kegemaran":"☆ Kegemaran",Array.isArray(e.tags)&&e.tags.length){const t=document.createElement("div");t.className="mt-2 flex flex-wrap gap-1",e.tags.forEach(e=>{const a=document.createElement("span");a.className="text-[11px] rounded-full bg-gray-100 px-2 py-0.5",a.textContent=e,t.appendChild(a)}),n.appendChild(t)}return n.appendChild(s),n.appendChild(o),n.appendChild(i),n.appendChild(l),t.appendChild(a),t.appendChild(n),t}function renderGrid(){a&&a.remove();const e=function applyFilters(e){let t=e;if("all"!==c.activeCat&&(t=t.filter(e=>e.category===c.activeCat)),c.onlyFavs&&(t=t.filter(e=>c.favorites.has(e.id))),c.q){const e=c.q.toLowerCase();t=t.filter(t=>t.name&&t.name.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e)||Array.isArray(t.tags)&&t.tags.some(t=>t.toLowerCase().includes(e)))}return t}(c.products);t.innerHTML="",e.forEach(e=>t.appendChild(cardEl(e)));const r=c.onlyFavs&&0===e.length,o=c.q&&0===e.length;n?.classList.toggle("hidden",!r),s?.classList.toggle("hidden",!o)}r?.addEventListener("click",()=>{const e="true"===r.dataset.active;r.dataset.active=String(!e),r.setAttribute("aria-pressed",String(!e)),r.classList.toggle("bg-blue-600",!e),r.classList.toggle("text-white",!e),c.onlyFavs=!e,renderGrid()}),o?.addEventListener("input",()=>{c.q=o.value.trim(),renderGrid()}),t.addEventListener("click",e=>{const t=e.target.closest("[data-fav]");if(!t)return;const a=t.dataset.fav,r=!c.favorites.has(a);var n;r?c.favorites.add(a):c.favorites.delete(a),n=c.favorites,localStorage.setItem(i,JSON.stringify([...n])),t.setAttribute("aria-pressed",String(r)),t.textContent=r?"★ Kegemaran":"☆ Kegemaran",t.className="mt-2 text-[12px] px-2 py-1 rounded-lg ring-1 "+(r?"ring-rose-300 bg-rose-50 text-rose-700":"ring-gray-300 text-gray-700 bg-white"),c.onlyFavs&&!r&&renderGrid()}),async function init(){try{await async function loadProducts(){const e=await fetch("/assets/data/products.json",{cache:"no-store"});if(!e.ok)throw new Error("Failed to load products.json");const t=await e.json();c.products=Array.isArray(t)?t:[];const a=new Set(c.products.map(e=>e.category).filter(Boolean));c.categories=["all",...[...a].sort()]}(),renderCategories(),renderGrid()}catch(e){console.error(e),t&&(t.innerHTML='<div class="col-span-2 text-xs text-rose-600">Gagal memuatkan produk.</div>')}}()})();
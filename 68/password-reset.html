<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Password Reset</title>
<link rel="stylesheet" href="/assets/tailwind.min.css">
</head>
<body class="min-h-screen bg-gray-50">
  <main class="max-w-sm mx-auto p-4 sm:p-6">
    <div class="bg-white border rounded-xl p-4 sm:p-6">
      <h1 class="text-lg font-semibold mb-2">Reset your password</h1>
      <div class="space-y-2">
        <input id="email" type="email" placeholder="Email" class="border rounded-lg px-3 py-2 w-full">
        <input id="token" type="text" placeholder="Token" class="border rounded-lg px-3 py-2 w-full">
        <input id="pw1" type="password" placeholder="New password" class="border rounded-lg px-3 py-2 w-full">
        <input id="pw2" type="password" placeholder="Confirm password" class="border rounded-lg px-3 py-2 w-full">
        <button id="go" class="px-3 py-2 rounded-lg bg-gray-900 text-white w-full">Reset password</button>
        <div id="msg" class="text-sm text-gray-600"></div>
      </div>
    </div>
  </main>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  if (qs.get('email')) document.getElementById('email').value = qs.get('email');
  if (qs.get('token')) document.getElementById('token').value = qs.get('token');
})();

document.getElementById('go').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const token = document.getElementById('token').value.trim();
  const pw1 = document.getElementById('pw1').value;
  const pw2 = document.getElementById('pw2').value;
  const msg = document.getElementById('msg');
  msg.textContent = '';
  if (!email || !token || !pw1 || !pw2){ msg.textContent = 'All fields are required.'; return; }
  if (pw1 !== pw2){ msg.textContent = 'Passwords do not match.'; return; }
  const res = await fetch('/api/reset/perform', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ email, token, newPassword: pw1 })
  });
  const j = await res.json().catch(()=>({ ok:false, error:'Bad response' }));
  if (!res.ok || !j.ok){ msg.textContent = 'Reset failed: ' + (j.error || ''); return; }
  msg.textContent = 'Password updated. You can close this tab and sign in.';
});
</script>
</body>
</html>

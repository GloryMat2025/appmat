(()=>{const $=(e,t=document)=>t.querySelector(e),e=$("#savedList"),t=$("#savedRow"),d=$("#savedEmpty"),a=$("#clearAll"),r=document.getElementById("addressForm"),s={label:$("#label"),addr1:$("#addr1"),addr2:$("#addr2"),city:$("#city"),state:$("#state"),postcode:$("#postcode"),save:$("#save"),makeDefault:$("#makeDefault"),hiddenAddr:$("#addressHidden"),hiddenLabel:$("#addressLabelHidden")},l={addr1:$("#err-addr1"),city:$("#err-city"),postcode:$("#err-postcode")},n="savedAddresses:v2",load=()=>{try{return JSON.parse(localStorage.getItem(n)||"[]")}catch{return[]}},save=e=>localStorage.setItem(n,JSON.stringify(e)),validate=()=>{let e=!0;const show=(e,t)=>e&&e.classList.toggle("hidden",!t);return s.addr1.value.trim()?show(l.addr1,!1):(show(l.addr1,!0),e=!1),s.city.value.trim()?show(l.city,!1):(show(l.city,!0),e=!1),/^\d{5}$/.test(s.postcode.value.trim())?show(l.postcode,!1):(show(l.postcode,!0),e=!1),e};function renderSaved(){const a=load();e.innerHTML="",d.classList.toggle("hidden",a.length>0),a.forEach((d,a)=>{const r=t.content.cloneNode(!0);$(".label",r).textContent=d.label||"Alamat",$(".address",r).textContent=d.address,d.isDefault&&$(".defaultBadge",r)?.classList.remove("hidden"),$(".use",r).addEventListener("click",()=>{const e=new URL("/index.html",location.origin);e.searchParams.set("address",d.address),d.label&&e.searchParams.set("addressLabel",d.label),location.href=e.toString()}),$(".edit",r).addEventListener("click",()=>{s.label.value=d.label||"";const e=d.address.split(",").map(e=>e.trim());s.addr1.value=e[0]||"",s.addr2.value=e.length>4?e.slice(1,e.length-3).join(", "):e[1]||"",s.city.value=e[e.length-3]||"",s.state.value=e[e.length-2]||"",s.postcode.value=e[e.length-1]||"",window.scrollTo({top:0,behavior:"smooth"})}),$(".star",r).addEventListener("click",()=>{const e=load().map((e,t)=>({...e,isDefault:t===a}));save(e),renderSaved()}),$(".del",r).addEventListener("click",()=>{const e=load();e.splice(a,1),save(e),renderSaved()}),e.appendChild(r)})}a?.addEventListener("click",()=>{save([]),renderSaved()}),renderSaved(),["input","change"].forEach(e=>{s.addr1.addEventListener(e,validate),s.city.addEventListener(e,validate),s.postcode.addEventListener(e,validate)}),r?.addEventListener("submit",e=>{if(!validate())return void e.preventDefault();const t=[s.addr1.value.trim(),s.addr2.value.trim(),s.city.value.trim(),s.state.value.trim(),s.postcode.value.trim()].filter(Boolean).join(", "),d=s.label.value.trim();if(s.hiddenAddr.value=t,d&&(s.hiddenLabel.value=d),s.save?.checked){const e=load(),a={id:crypto?.randomUUID?.()||String(Date.now()),label:d,address:t,isDefault:!!s.makeDefault?.checked,createdAt:Date.now()};let r=[a,...e];a.isDefault&&(r=r.map((e,t)=>0===t?e:{...e,isDefault:!1})),save(r.slice(0,20))}})})();
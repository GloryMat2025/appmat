!function(){const e=document.getElementById("appDialog"),n=e.querySelector("[data-modal-body]");window.openPopup=async function(o,t={}){n.innerHTML=await async function fetchPartial(e){const n=await fetch(e,{cache:"no-store"});if(!n.ok)throw new Error(`Failed to load ${e}`);return n.text()}(`/popups/${o}.html`),e.showModal(),n.querySelectorAll("[data-close]").forEach(e=>{e.addEventListener("click",e=>{e.preventDefault(),cleanup(null)},{once:!0})});const l=window.PopupControllers?.[o];return new Promise(o=>{function cleanup(t){e.close(),n.innerHTML="",o(t??null)}e.addEventListener("cancel",e=>{e.preventDefault(),cleanup(null)},{once:!0}),l?.(e,t,cleanup)})}}();
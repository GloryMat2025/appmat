<!doctype html>
<html lang="en" class="h-full">
<head>
  <link rel="manifest" href="/public/manifest.json">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#ff5a5f" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'wasm-unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self'; manifest-src 'self'; media-src 'self'; object-src 'none'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'">
  <link rel="manifest" href="./manifest.webmanifest" crossorigin="use-credentials" />
  <title>Home (Pure HTML)</title>

  <!-- Local Tailwind build -->
  <link rel="stylesheet" href="./assets/tailwind.min.css" />

  <!-- Removed Swiper dependency: using native scroll-snap carousel -->
  <style>
    @media (prefers-reduced-motion: reduce){*{animation:none!important;transition:none!important}}
  </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-900 pb-24">
  <div id="connectivityBanner" class="fixed top-0 left-0 w-full z-[100] hidden">
    <div class="mx-auto max-w-sm bg-red-500 text-white text-center py-2 text-sm font-semibold rounded-b-2xl shadow-lg animate-pulse">
      <span>You're offline. Some features may be unavailable.</span>
    </div>
  </div>
  <a href="#mainContent" class="skip-link">Skip to content</a>

<!-- Segmented links -->
    <div class="col-span-2 flex items-center justify-center">
      <div class="inline-flex overflow-hidden rounded-xl ring-1 ring-gray-300 bg-white dark:bg-slate-900" role="tablist" aria-label="Mod Penghantaran/Pengambilan">
  <a href="#" class="px-3 py-1.5 text-xs font-semibold bg-blue-600 text-white" role="tab" aria-selected="true" tabindex="0" id="bottomDelivery">Delivery</a>
  <a href="#" class="px-3 py-1.5 text-xs font-semibold text-gray-900 dark:text-slate-100" role="tab" aria-selected="false" tabindex="-1" id="bottomPickup">Pickup</a>
      </div>
    </div>

  <!-- Delivery / Pickup Popup Modals -->
  <div id="deliveryModal" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center hidden" role="dialog" aria-modal="true" aria-labelledby="deliveryModalTitle">
    <div class="bg-white rounded-2xl shadow-lg max-w-xs w-full p-6 relative" tabindex="-1">
      <button type="button" id="closeDeliveryModal" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center" aria-label="Close">✕</button>
  <h2 id="deliveryModalTitle" class="text-lg font-semibold mb-2" data-i18n="modal.delivery.title">Delivery Info</h2>
  <p class="text-sm text-gray-600 mb-4" data-i18n="modal.delivery.desc">Choose delivery options, address, and time slot here. (Demo popup)</p>
  <button type="button" id="okDeliveryModal" class="w-full py-2 rounded bg-blue-600 text-white font-semibold" data-i18n="modal.ok">OK</button>
    </div>
  </div>
  <div id="pickupModal" class="fixed inset-0 z-50 bg-black/40 flex items-center justify-center hidden" role="dialog" aria-modal="true" aria-labelledby="pickupModalTitle">
    <div class="bg-white rounded-2xl shadow-lg max-w-xs w-full p-6 relative" tabindex="-1">
      <button type="button" id="closePickupModal" class="absolute top-2 right-2 w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center" aria-label="Close">✕</button>
  <h2 id="pickupModalTitle" class="text-lg font-semibold mb-2" data-i18n="modal.pickup.title">Pickup Info</h2>
  <p class="text-sm text-gray-600 mb-4" data-i18n="modal.pickup.desc">Choose pickup location and time slot here. (Demo popup)</p>
  <button type="button" id="okPickupModal" class="w-full py-2 rounded bg-blue-600 text-white font-semibold" data-i18n="modal.ok">OK</button>
    </div>
  </div>
  <div id="mainContent" tabindex="-1">

  <!-- Top toggle + search -->
  <section class="p-4">
  <div class="bg-white rounded-2xl shadow ring-1 ring-gray-200 p-4">

      <div class="mt-4 flex items-center gap-2 rounded-full bg-gray-100 px-4 h-12" data-search-wrapper>
        <button id="langToggle" class="text-[11px] font-semibold px-2 py-2 rounded-lg border border-ring bg-white" style="margin-right:8px;">BM/EN</button>
        <svg class="w-5 h-5 opacity-60" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
</div>
<script>
  // Simple i18n dictionary
  const translations = {
    en: {
      'lang.toggle': 'BM',
      'nav.home': 'Home',
      'nav.menu': 'Menu',
      'nav.cart': 'Cart',
      'nav.rewards': 'Rewards',
      'nav.account': 'Account',
      'card.wallet': 'Wallet Balance',
      'search.placeholder': 'Search',
      'modal.delivery.title': 'Delivery Info',
      'modal.delivery.desc': 'Choose delivery options, address, and time slot here. (Demo popup)',
      'modal.pickup.title': 'Pickup Info',
      'modal.pickup.desc': 'Choose pickup location and time slot here. (Demo popup)',
      'modal.ok': 'OK',
    },
    bm: {
      'lang.toggle': 'EN',
      'nav.home': 'Laman Utama',
      'nav.menu': 'Menu',
      'nav.cart': 'Troli',
      'nav.rewards': 'Ganjaran',
      'nav.account': 'Akaun',
      'card.wallet': 'Baki Dompet',
      'search.placeholder': 'Cari',
      'modal.delivery.title': 'Maklumat Penghantaran',
      'modal.delivery.desc': 'Pilih pilihan penghantaran, alamat, dan slot masa di sini. (Popup demo)',
      'modal.pickup.title': 'Maklumat Ambil Sendiri',
      'modal.pickup.desc': 'Pilih lokasi dan slot masa ambil sendiri di sini. (Popup demo)',
      'modal.ok': 'OK',
    }
  };
  let lang = localStorage.getItem('lang') || 'en';
  function setLang(l) {
    lang = l;
    localStorage.setItem('lang', l);
    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (translations[l][key]) el.textContent = translations[l][key];
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
      const key = el.getAttribute('data-i18n-placeholder');
      if (translations[l][key]) el.setAttribute('placeholder', translations[l][key]);
    });
    // Update toggle button label
    const btn = document.getElementById('langToggle');
    if (btn) btn.textContent = l === 'en' ? 'BM/EN' : 'EN/BM';
  }
  document.addEventListener('DOMContentLoaded', () => {
    setLang(lang);
    const btn = document.getElementById('langToggle');
    if (btn) btn.onclick = () => setLang(lang === 'en' ? 'bm' : 'en');
  });
</script>
          <circle cx="11" cy="11" r="7"/><path d="M20 20l-3-3"/>
        </svg>
  <input type="text" placeholder="Search" data-i18n-placeholder="search.placeholder" data-search-input
               class="flex-1 bg-transparent outline-none text-sm placeholder-gray-400" />
        <button type="button" data-search-clear class="w-7 h-7 hidden rounded-full bg-white ring-1 ring-gray-300 text-gray-500 hover:bg-gray-50 text-[11px] font-semibold" aria-label="Clear">✕</button>
      </div>
    </div>
  </section>

  <!-- Product image carousel (native) -->
  <section class="px-4 mt-4">
    <div class="bg-white rounded-2xl ring-1 ring-gray-200 p-3 relative">
      <div class="group relative">
        <div class="rounded-xl overflow-hidden">
          <div class="flex overflow-x-auto gap-3 snap-x snap-mandatory scroll-smooth no-scrollbar" data-carousel-track style="scroll-padding:0.5rem">
            <div class="shrink-0 w-full snap-start rounded-xl overflow-hidden relative aspect-[16/9] bg-gray-200">
              <img class="absolute inset-0 w-full h-full object-cover" src="assets/images/carousel/slide-01.jpg" alt="Promo 1" loading="lazy" decoding="async" />
            </div>
            <div class="shrink-0 w-full snap-start rounded-xl overflow-hidden relative aspect-[16/9] bg-gray-200">
              <img class="absolute inset-0 w-full h-full object-cover" src="assets/images/carousel/slide-02.jpg" alt="Promo 2" loading="lazy" decoding="async" />
            </div>
            <div class="shrink-0 w-full snap-start rounded-xl overflow-hidden relative aspect-[16/9] bg-gray-200">
              <img class="absolute inset-0 w-full h-full object-cover" src="assets/images/carousel/slide-03.jpg" alt="Promo 3" loading="lazy" decoding="async" />
            </div>
          </div>
          <button type="button" data-carousel-prev class="hidden sm:flex absolute top-1/2 -translate-y-1/2 left-2 backdrop-blur bg-white/70 hover:bg-white text-gray-700 w-9 h-9 rounded-full shadow-soft items-center justify-center">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
          </button>
          <button type="button" data-carousel-next class="hidden sm:flex absolute top-1/2 -translate-y-1/2 right-2 backdrop-blur bg-white/70 hover:bg-white text-gray-700 w-9 h-9 rounded-full shadow-soft items-center justify-center">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
          </button>
        </div>
        <div class="mt-3 flex items-center justify-center gap-2" data-carousel-dots>
          <button aria-label="Slide 1" data-index="0" class="w-2.5 h-2.5 rounded-full bg-blue-600/70 data-[active=true]:bg-blue-600"></button>
          <button aria-label="Slide 2" data-index="1" class="w-2.5 h-2.5 rounded-full bg-gray-400 data-[active=true]:bg-blue-600"></button>
          <button aria-label="Slide 3" data-index="2" class="w-2.5 h-2.5 rounded-full bg-gray-400 data-[active=true]:bg-blue-600"></button>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== Menu bawah container: 2 column layout ===== -->
  <section class="px-4 mt-4" id="menu">
    <div class="bg-white rounded-2xl ring-1 ring-gray-200 p-3">
  <div class="flex items-center justify-between px-1 gap-3">
    <h2 class="text-base font-semibold" data-i18n="menu.title">Menu</h2>
    <button data-favorites-filter class="text-[11px] font-semibold px-3 py-1.5 rounded-full ring-1 ring-gray-300 data-[active=true]:bg-blue-600 data-[active=true]:text-white" aria-pressed="false" data-i18n="favorites.filterOnly">Only Favorites</button>
  </div>

      <!-- Category pills -->
      <div class="mt-3 flex gap-2 overflow-x-auto pb-1" data-category-bar>
        <!-- Dynamic category pills inserted by app.js -->
      </div>

      <!-- grid: kiri 96px flags, kanan produk -->
      <div class="mt-3 grid [grid-template-columns:96px_1fr] gap-3 sm:[grid-template-columns:112px_1fr]">

        <!-- LEFT: flags (PNG), scrollable -->
        <aside class="rounded-xl ring-1 ring-gray-200 bg-gray-50 p-2 max-h-[480px] overflow-y-auto">
          <ul class="grid gap-2">
            <!-- Tukar src ke fail sebenar dalam assets/images/flags/*.png -->
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2 data-[active=true]:ring-blue-500" data-active="true">
              <img src="assets/images/flags/johor.png" alt="Malaysia" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium"></span>
            </button></li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/kedah.png" alt="Thailand" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">TH</span>
            </button></li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/kelantan.png" alt="Singapore" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">SG</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/kuala-lumpur.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
            </button></li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/Melaka.png" alt="Indonesia" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">ID</span>
            </button></li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/negeri-sembilan.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/pahang.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/perak.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/perlis.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/pulau-pinang.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/sabah.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/sarawak.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/selangor.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
              </li>
            <li><button class="flag-btn w-full rounded-lg ring-1 ring-gray-200 bg-white p-2 flex flex-col items-center gap-2">
              <img src="assets/images/flags/terengganu.png" alt="Brunei" class="w-8 h-6 object-cover rounded" loading="lazy">
              <span class="text-[10px] font-medium">BN</span>
            </button></li>
            
            <!-- Tambah lagi sampai 14 bendera ikut keperluan -->
          </ul>
        </aside>

        <!-- RIGHT: product cards (nama + harga RM) -->
        <div class="grid grid-cols-2 gap-3" data-products-grid data-products-skeleton>
          <!-- Dynamic product cards, outlet filter, skeleton, and empty states are all injected by app.js -->
        </div>
      </div>
    </div>
  </section>

  <!-- Last Order -->
  <section class="px-4 mt-4">
    <div class="bg-white rounded-2xl ring-1 ring-gray-200">
      <div class="flex items-center justify-between p-4">
  <h2 class="font-semibold" data-i18n="last.title">Your Last Order</h2>
        <button class="w-8 h-8 grid place-items-center rounded-full ring-1 ring-gray-300">
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M9 18l6-6-6-6"/>
          </svg>
        </button>
      </div>
      <div class="px-4 pb-4">
        <div class="rounded-xl bg-gray-50 ring-1 ring-gray-200 p-4 text-center text-sm text-gray-600">
          <span data-i18n-html="last.empty">No last order yet.<br/>Start ordering now.</span>
        </div>
      </div>
    </div>
  </section>

  </div>
  <!-- Bottom nav (optional) -->
  <!-- Mobile first: show 5 tabs; on md+ layout can be expanded if needed -->
  <nav aria-label="Primary" class="fixed bottom-3 inset-x-0 mx-auto max-w-sm bg-white/90 dark:bg-slate-800/80 backdrop-blur rounded-2xl border border-ring dark:border-slate-600 shadow-soft p-2 grid grid-cols-5 md:grid-cols-5 gap-1">
  <a data-tab="home" href="./index.html" class="flex flex-col items-center gap-1 py-2 rounded-xl">🏠<span class="text-xs" data-i18n="nav.home">Home</span></a>
  <a data-tab="menu" href="./menu.html" class="flex flex-col items-center gap-1 py-2 rounded-xl" aria-current="page">🍽️<span class="text-xs" data-i18n="nav.menu">Menu</span></a>
  <a data-tab="cart" href="./cart.html" class="flex flex-col items-center gap-1 py-2 rounded-xl">🛒<span class="text-xs" data-i18n="nav.cart">Cart</span></a>
  <a data-tab="rewards" href="./rewards.html" class="flex flex-col items-center gap-1 py-2 rounded-xl">🏆<span class="text-xs" data-i18n="nav.rewards">Rewards</span></a>
  <a data-tab="account" href="./account.html" class="flex flex-col items-center gap-1 py-2 rounded-xl">👤<span class="text-xs" data-i18n="nav.account">Account</span></a>
  </nav>

  <!-- Native carousel + small scripts -->
  <script>

    // Top nav click handlers for Penghantaran and Pengambilan
    document.getElementById('navDelivery')?.addEventListener('click', function(e) {
      e.preventDefault();
      window.open('/assets/popups/set-your-address.html', 'setAddress', 'width=400,height=600,modal=yes,alwaysRaised=yes');
    });
    document.getElementById('navPickup')?.addEventListener('click', function(e) {
      e.preventDefault();
      window.open('/assets/popups/select-your-outlet.html', 'selectOutlet', 'width=400,height=600,modal=yes,alwaysRaised=yes');
    });

    // Native carousel helper
    (function(){
      const track = document.querySelector('[data-carousel-track]');
      if(!track) return;
      const dots = Array.from(document.querySelectorAll('[data-carousel-dots] [data-index]'));
      const prevBtn = document.querySelector('[data-carousel-prev]');
      const nextBtn = document.querySelector('[data-carousel-next]');
      const slides = Array.from(track.children);
      function setActive(idx){ dots.forEach(d=>d.dataset.active = (d.dataset.index == idx)); }
      function snapTo(idx){ const el = slides[idx]; if(el){ el.scrollIntoView({behavior:'smooth'}); current = idx; setActive(idx);} }
      let current = 0;
      dots.forEach(d=>d.addEventListener('click', ()=>snapTo(Number(d.dataset.index))));
      prevBtn?.addEventListener('click', ()=>snapTo((current - 1 + slides.length) % slides.length));
      nextBtn?.addEventListener('click', ()=>snapTo((current + 1) % slides.length));
      let raf; track.addEventListener('scroll', ()=>{ cancelAnimationFrame(raf); raf = requestAnimationFrame(()=>{ const idx = Math.round(track.scrollLeft / track.clientWidth); if(idx!==current){ current=idx; setActive(idx);} }); });
      setActive(0);
      let auto = setInterval(()=> nextBtn?.click(), 5000); track.addEventListener('pointerdown', ()=>{ clearInterval(auto); auto=null; });
    })();

    // Flag active state (visual only)
    document.querySelectorAll(".flag-btn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".flag-btn").forEach(b=>b.dataset.active="false");
        btn.dataset.active = "true";
      });
    });
  </script>
  <!-- Toast system -->
  <div id="toast-root" class="fixed z-50 inset-x-0 bottom-4 flex flex-col items-center gap-2 pointer-events-none" aria-live="polite" aria-atomic="true"></div>
  <script src="./js/toast.js"></script>
  <script src="./assets/js/min.js"></script>
  <script src="./assets/js/products-grid.js"></script>
  <!-- Dialog shell used by popup fragments (product-details, select-your-outlet, etc.) -->
  <dialog id="appDialog" class="rounded-2xl p-0 w-[min(96vw,760px)]" aria-hidden="true"><div data-modal-body></div></dialog>
</body>
<script>
  // Accessibility: modal focus trap, ESC to close, return focus
  function trapFocus(modal) {
    const focusable = modal.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');
    const first = focusable[0];
    const last = focusable[focusable.length-1];
    modal.addEventListener('keydown', function(e) {
      if(e.key === 'Tab') {
        if(e.shiftKey) { if(document.activeElement===first){ e.preventDefault(); last.focus(); } }
        else { if(document.activeElement===last){ e.preventDefault(); first.focus(); } }
      }
    });
  }
  function showModal(modal, opener) {
    modal.classList.remove('hidden');
    const dialog = modal.querySelector('[tabindex="-1"]');
    setTimeout(()=>dialog.focus(), 10);
    trapFocus(dialog);
    function closeModal() {
      modal.classList.add('hidden');
      opener && opener.focus();
      dialog.removeEventListener('keydown', escListener);
    }
    function escListener(e) { if(e.key==='Escape'){ e.preventDefault(); closeModal(); } }
    dialog.addEventListener('keydown', escListener);
    modal.querySelectorAll('[id^="close"],[id^="ok"]').forEach(btn=>btn.onclick=closeModal);
    return closeModal;
  }
  let lastOpener = null;

    // Delivery/Pickup toggle modal logic for menu.html
    const dBtn = document.getElementById('bottomDelivery');
    const pBtn = document.getElementById('bottomPickup');
    function setMode(m, focusBtn) {
      if(!dBtn||!pBtn) return;
      if(m==='delivery'){
        dBtn.classList.add('bg-blue-600','text-white');
        dBtn.classList.remove('text-gray-900','dark:text-slate-100');
        pBtn.classList.add('text-gray-900','dark:text-slate-100');
        pBtn.classList.remove('bg-blue-600','text-white');
        dBtn.setAttribute('aria-selected','true');
        pBtn.setAttribute('aria-selected','false');
        dBtn.tabIndex = 0;
        pBtn.tabIndex = -1;
        if(focusBtn) dBtn.focus();
      } else {
        pBtn.classList.add('bg-blue-600','text-white');
        pBtn.classList.remove('text-gray-900','dark:text-slate-100');
        dBtn.classList.add('text-gray-900','dark:text-slate-100');
        dBtn.classList.remove('bg-blue-600','text-white');
        dBtn.setAttribute('aria-selected','false');
        pBtn.setAttribute('aria-selected','true');
        dBtn.tabIndex = -1;
        pBtn.tabIndex = 0;
        if(focusBtn) pBtn.focus();
      }
      localStorage.setItem('orderMode', m);
    }
    dBtn?.addEventListener('click', function(e) {
  e.preventDefault();
  setMode('delivery');
  lastOpener = dBtn;
  showModal(document.getElementById('deliveryModal'), dBtn);
    });
    pBtn?.addEventListener('click', function(e) {
  e.preventDefault();
  setMode('pickup');
  lastOpener = pBtn;
  showModal(document.getElementById('pickupModal'), pBtn);
    });
    // Keyboard navigation
    [dBtn, pBtn].forEach((btn, idx, arr) => {
      btn?.addEventListener('keydown', function(e) {
        if(e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
          e.preventDefault();
          const next = (idx + (e.key==='ArrowRight'?1:-1) + arr.length) % arr.length;
          setMode(next===0?'delivery':'pickup', true);
        } else if(e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          btn.click();
        }
      });
    });
    setMode(localStorage.getItem('orderMode') || 'delivery');

    // Bottom nav click handlers for Penghantaran and Pengambilan
    document.getElementById('bottomDelivery')?.addEventListener('click', function(e) {
      e.preventDefault();
      window.open('/assets/popups/set-your-address.html', 'setAddress', 'width=400,height=600,modal=yes,alwaysRaised=yes');
    });
    document.getElementById('bottomPickup')?.addEventListener('click', function(e) {
      e.preventDefault();
      window.open('/assets/popups/select-your-outlet.html', 'selectOutlet', 'width=400,height=600,modal=yes,alwaysRaised=yes');
    });
if('serviceWorker' in navigator){
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./sw.js').catch(console.error);
  });
}
</script>
</html>

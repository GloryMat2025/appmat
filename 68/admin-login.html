<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Admin Login — Business Hours</title>
<link rel="stylesheet" href="/assets/tailwind.min.css">
<style>
  body{ background:#f7f7f8; }
</style>
</head>
<body class="min-h-screen">
  <header class="bg-white border-b p-3 flex items-center justify-between">
    <div class="font-semibold">Admin — Business Hours</div>
    <a href="/assets/pages/dev/business-hours-outlets.html" class="text-sm text-blue-600">Preview</a>
  </header>

  <main class="max-w-5xl mx-auto p-4 sm:p-6 space-y-4">
    <div id="loginCard" class="max-w-sm bg-white border border-gray-200 rounded-xl p-4 sm:p-6 shadow-sm mx-auto">
      <h1 class="text-lg font-semibold mb-1">Sign in</h1>
      <p class="text-sm text-gray-600 mb-4">Use your staff credentials.</p>
      <div class="space-y-2">
        <input id="email" type="email" placeholder="Email" class="border rounded-lg px-3 py-2 w-full">
        <input id="password" type="password" placeholder="Password" class="border rounded-lg px-3 py-2 w-full">
        <button id="loginBtn" class="px-3 py-2 rounded-lg bg-gray-900 text-white w-full">Sign in</button>
        <div id="err" class="text-xs text-red-600 mt-2 hidden">Invalid email or password</div>
      </div>
      <div class="text-xs text-gray-500 mt-3">Demo user: admin@example.com / admin123</div>
    </div>

    <div id="app" class="hidden">
      <div class="flex items-center justify-between mb-2">
        <div class="text-sm text-gray-600" id="who"></div>
        <button id="logoutBtn" class="text-sm underline">Logout</button>
      </div>
      <iframe src="/assets/pages/dev/business-hours-settings.html" class="w-full h-[80vh] border rounded-xl bg-white"></iframe>
      <div class="text-xs text-gray-500 mt-2">Settings writes will go to <code>/api/schedule</code> when integrated.</div>
    </div>
  </main>

<script type="module">
async function session(){
  const res = await fetch('/api/session', { credentials:'include' });
  return res.json();
}
async function login(email, password){
  const res = await fetch('/api/login', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    credentials: 'include',
    body: JSON.stringify({ email, password })
  });
  if (!res.ok) throw new Error('Login failed');
  return res.json();
}
async function logout(){
  await fetch('/api/logout', { method:'POST', credentials:'include' });
}

const loginCard = document.getElementById('loginCard');
const app = document.getElementById('app');
const who = document.getElementById('who');

document.getElementById('loginBtn').addEventListener('click', async () => {
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value.trim();
  document.getElementById('err').classList.add('hidden');
  try {
    await login(email, password);
    const s = await session();
    if (s.authenticated){
      who.textContent = `${s.user.name} (${s.user.email}) — ${s.user.role}`;
      loginCard.classList.add('hidden');
      app.classList.remove('hidden');
    } else {
      document.getElementById('err').classList.remove('hidden');
    }
  } catch {
    document.getElementById('err').classList.remove('hidden');
  }
});

document.getElementById('logoutBtn').addEventListener('click', async () => {
  await logout();
  location.reload();
});

// Auto-continue if already logged in
session().then(s => {
  if (s.authenticated){
    who.textContent = `${s.user.name} (${s.user.email}) — ${s.user.role}`;
    loginCard.classList.add('hidden');
    app.classList.remove('hidden');
  }
});
</script>
</body>
</html>
